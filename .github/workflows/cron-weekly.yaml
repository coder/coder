name: Markdown Links Check
# runs every monday at 9 am
on:
  schedule:
    - cron: "0 9 * * 1"
  workflow_dispatch:

jobs:
  check-links:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@master

      - name: Check Markdown links
        uses: gaurav-nelson/github-action-markdown-link-check@v1
        id: markdown-link-check
        # checks all markdown files from /docs including all subfolders
        with:
          use-quiet-mode: "yes"
          use-verbose-mode: "yes"
          config-file: ".github/workflows/markdown.links.config.json"
          folder-path: "docs/"

  post-to-slack:
    runs-on: ubuntu-latest
    needs: check-links
    if: ${{ always() }}
    steps:
      - name: Post to Slack
        id: post-to-slack
        uses: slackapi/slack-github-action@v1.23.0
        with:
          payload: |
            {
              "msg": "${{ steps.markdown-link-check.outputs}}",
            }
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.DOCS_LINK_SLACK_WEBHOOK }}
